"use strict";function _classCallCheck(a,i){if(!(a instanceof i))throw new TypeError("Cannot call a class as a function")}var picsumURL=function(a){return"https://picsum.photos/v2/list?page=".concat(a,"&limit=100")},linkBox=$("#modal-link-box"),imgContainer=$("#img-container"),loadedImg=$("#loaded-img"),btnLink=$(".btn-link"),btnRefresh=$(".btn-refresh"),btnRefreshHTML='<i class="fas fa-redo-alt" id="icon-refresh"></i>',emailField=$("#user-email-field"),linkStatus=$("#status"),btnPastEmail=$(".btn-past-email"),btnCancel=$(".btn-cancel"),btnLinkIt=$(".btn-linkit"),displayedImg=null,linkedImages={},savedEmails={},lastUsedEmail=null,mailFormat=/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/,ImageDetails=function a(i,n,e,l,t){_classCallCheck(this,a),this.id=i,this.author=n,this.url=e,this.download_url=l,this.links=t},getImages=function(){var a=Math.floor(10*Math.random()+1),a=picsumURL(a);axios.get(a).then(function(a){pickRandomImage(a.data),$("#error").remove()}).catch(function(a){return errorHandler(a)})},pickRandomImage=function(a){var i=a[Math.floor(Math.random()*(a.length-1))],a=checkLinks(i);displayedImg=new ImageDetails(i.id,i.author,i.url,i.download_url,a),loadImage(),loadImageDetails()},checkLinks=function(a){if(jQuery.isEmptyObject(linkedImages))return[];for(var i in linkedImages)return 0<linkedImages[i].links.length&&i===a.id?linkedImages[i].links:[]},loadImage=function(){var a=new Image;a.onload=function(){btnRefresh.html("".concat(btnRefreshHTML,"New Image")).removeClass("loading").removeAttr("disabled"),btnLink.removeClass("loading").removeAttr("disabled"),imgContainer.append(a),(loadedImg=$("#loaded-img")).fadeIn(500)},a.id="loaded-img",a.src=displayedImg.download_url},loadImageDetails=function(){$("#photo-info").html('\n        <div id="photo-heading">\n            <div id="photo-id">\n                <h2>Image</h2>\n                <span>'.concat(displayedImg.id,'</span>\n            </div>\n            <div id="links-count">\n                <i class="fas fa-link"></i> ').concat(displayedImg.links.length,'\n            </div>\n        </div>\n        <ul id="info-list">\n            <li><i class="fas fa-user-circle"></i>').concat(displayedImg.author,'</li>\n            <li><i class="fab fa-unsplash"></i><a href="').concat(displayedImg.url,'" target="_blank">View this image on Unsplash</a></li>\n        </li>\n    '))},newImage=function(){loadedImg.fadeOut(500,function(){loadedImg.remove(),getImages()})},errorHandler=function(a){imgContainer.html('\n        <div id="error">\n            <h2>Something went wrong!</h2>\n            <span>'.concat(a,"</span>\n        </div>\n    "))},linkEmail=function(a){var i,n=!0,e=!1;for(i in savedEmails)if(i===a){n=!1;break}if(n)savedEmails["".concat(a)]=[displayedImg];else{for(var l=0;l<savedEmails["".concat(a)].length;l++)if(savedEmails["".concat(a)][l].id===displayedImg.id){e=!0;break}e?(emailField.focus(),linkStatus.addClass("fail").html('\n                    <i class="fas fa-exclamation-circle"></i> Email already linked!\n                '),modalBtnDisable("enable")):savedEmails["".concat(a)].push(displayedImg)}return e},linkImage=function(a){validateEmail(a)?linkEmail(a)||(linkedImages[displayedImg.id]=displayedImg,linkedImages[displayedImg.id].links.push(a),$("#links-count").html('\n                <i class="fas fa-link" id="icon-link"></i> '.concat(linkedImages[displayedImg.id].links.length,"\n            ")),lastUsedEmail=a,linkStatus.removeClass("fail").addClass("success").html('\n                    <i class="fas fa-exclamation-circle"></i> Linked!\n                '),setTimeout(function(){modalFade("out")},1e3)):(emailField.focus(),linkStatus.addClass("fail").html('\n                <i class="fas fa-exclamation-circle"></i> Invalid email! Try again.\n            '),modalBtnDisable("enable"))},validateEmail=function(a){return!!(a.match(mailFormat)&&0<a.length)},logoColor=function(){var a=0;setInterval(function(){$("#icon-logo").css({color:"hsl(".concat(a,", 90%, 60%)"),"text-shadow":"0 0 5px hsl(".concat(a,", 90%, 60%)")}),360===++a&&(a=0)},10)},modalFade=function(a){"in"===a?(linkBox.fadeIn(500),emailField.focus(),null!==lastUsedEmail&&($("#past-email").show(),btnPastEmail.html("".concat(lastUsedEmail)))):"out"===a&&linkBox.fadeOut(500,function(){emailField.val(""),modalBtnDisable("enable"),linkStatus.removeClass("success","fail").html("")})},modalBtnDisable=function(a){"disable"===a?(btnPastEmail.attr("disabled","disabled"),btnCancel.attr("disabled","disabled"),btnLinkIt.attr("disabled","disabled")):"enable"===a&&(btnPastEmail.removeAttr("disabled"),btnCancel.removeAttr("disabled"),btnLinkIt.removeAttr("disabled"))};$(document).ready(function(){getImages(),logoColor()}),btnLink.on("click",function(){modalFade("in")}),btnRefresh.on("click",function(){newImage(),btnRefresh.html("".concat(btnRefreshHTML,"Loading...")).addClass("loading").attr("disabled","disabled"),btnLink.addClass("loading").attr("disabled","disabled"),$({rotation:0}).animate({rotation:360},{duration:1500,easing:"linear",step:function(){$("#icon-refresh").css({transform:"rotate(".concat(this.rotation,"deg)")})}})}),linkBox.on("click",function(a){Object.values($("#link-input").find("*")).includes(a.target)||modalFade("out")}),btnPastEmail.on("click",function(){modalBtnDisable("disable"),linkImage(lastUsedEmail)}),btnCancel.on("click",function(){modalFade("out")}),btnLinkIt.on("click",function(){modalBtnDisable("disable");var a=emailField.val();linkImage(a)}),emailField.keyup(function(a){13===a.keyCode&&btnLinkIt.click()});