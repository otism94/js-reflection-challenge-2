"use strict";function _classCallCheck(n,a){if(!(n instanceof a))throw new TypeError("Cannot call a class as a function")}var linkBox=$("#modal-link-box"),imgContainer=$("#img-container"),loadedImg=$("#loaded-img"),imgInfo=$("#photo-info"),btnLink=$(".btn-link"),btnRefresh=$(".btn-refresh"),btnRefreshHTML='<i class="fas fa-redo-alt" id="icon-refresh"></i>',btnHamburger=$(".hamburger"),emailField=$("#user-email-field"),linkStatus=$("#status"),btnPastEmail=$(".btn-past-email"),btnCancel=$(".btn-cancel"),btnLinkIt=$(".btn-linkit"),linksInfo=$("#links-info"),linksInfoSide=$("#sidemenu-links"),allLinkedEmailsList=$("#sidemenu-emails-list"),thisImgLinksHead=$("#sidemenu-links-h3"),allImgsLinksHead=$("#sidemenu-emails-h3"),linksList=$("#links-list"),linksListSide=$("#sidemenu-links-list"),noLinksInfo=$("#no-links"),noLinksInfoSide=$("#sidemenu-no-links"),linkedImgs={},displayedImg=null,savedEmails={},lastUsedEmail=null,mailFormat=/(?:[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*|"(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*")@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])/,ImageDetails=function n(a,i,e,l,s){_classCallCheck(this,n),this.id=a,this.author=i,this.url=e,this.download_url=l,this.links=s},getImages=function(){var n=Math.floor(10*Math.random()+1);axios.get("https://picsum.photos/v2/list?page=".concat(n,"&limit=100")).then(function(n){pickRandomImage(n.data),$("#error").remove()}).catch(function(n){return errorHandler(n)})},pickRandomImage=function(n){var a=n[Math.floor(Math.random()*(n.length-1))],n=checkLinks(a);displayedImg=new ImageDetails(a.id,a.author,a.url,a.download_url,n),loadImage(),loadImageDetails()},checkLinks=function(n){if(jQuery.isEmptyObject(linkedImgs))return[];for(var a in linkedImgs)return 0<linkedImgs[a].links.length&&a===n.id?linkedImgs[a].links:[]},loadImage=function(){var n=new Image;n.onload=function(){btnRefresh.html("".concat(btnRefreshHTML,"New Image")),btnRefresh.add(btnLink).removeClass("loading").removeAttr("disabled"),imgContainer.append(n),(loadedImg=$("#loaded-img")).fadeIn(500)},n.id="loaded-img",n.src=displayedImg.download_url},loadImageDetails=function(){imgInfo.html('\n        <div id="photo-heading">\n            <div id="photo-id">\n                <h2>Image</h2>\n                <span>'.concat(displayedImg.id,'</span>\n            </div>\n            <div id="links-count">\n                <i class="fas fa-link"></i> ').concat(displayedImg.links.length,'\n            </div>\n        </div>\n        <ul id="info-list">\n            <li><i class="fas fa-user-circle"></i>').concat(displayedImg.author,'</li>\n            <li><i class="fab fa-unsplash"></i><a href="').concat(displayedImg.url,'" target="_blank">View this image on Unsplash</a></li>\n        </li>\n    ')),displayedImg.links.length?displayedImg.links.forEach(function(n){noLinksInfo.add(noLinksInfoSide).add("#sidemenu-no-emails").hide(),linksList.add(linksListSide).append('\n                <li>\n                    <span class="email-links-count">'.concat(savedEmails[n].length,'</span> <span class="email-link">').concat(n,"</span>\n                </li>\n            "))}):noLinksInfo.add(noLinksInfoSide).show()},newImage=function(n,a){n?($("#column-1, #column-2").fadeOut(500),setTimeout(function(){$("#column-1, #column-2").remove(),a?(loadImage(),loadImageDetails()):getImages(),($(window).innerWidth<1024?linksInfoSide:linksInfo).show(),linksInfo.add(linksInfoSide).removeAttr("style")},500)):loadedImg.fadeOut(500,function(){loadedImg.remove(),getImages()}),linksList.add(linksListSide).children().toArray().forEach(function(n){return"sidemenu-no-links"!==$(n).attr("id")&&$(n).remove()}),btnRefresh.html("".concat(btnRefreshHTML,"Loading...")).addClass("loading").attr("disabled","disabled"),btnLink.addClass("loading").attr("disabled","disabled"),$({rotation:0}).animate({rotation:360},{duration:1500,easing:"linear",step:function(){$("#icon-refresh").css({transform:"rotate(".concat(this.rotation,"deg)")})}})},errorHandler=function(n){imgContainer.html('\n        <div id="error">\n            <h2>Something went wrong!</h2>\n            <span>'.concat(n,"</span>\n        </div>\n    "))},linkEmail=function(n){var a,i=!0,e=!1;for(a in savedEmails)if(a===n){i=!1;break}if(i)savedEmails["".concat(n)]=[displayedImg],updateEmails();else{for(var l=0;l<savedEmails["".concat(n)].length;l++)if(savedEmails["".concat(n)][l].id===displayedImg.id){e=!0;break}e?(emailField.focus(),linkStatus.addClass("fail").html('<i class="fas fa-exclamation-circle"></i> Email already linked!'),modalBtnDisable("enable")):(savedEmails["".concat(n)].push(displayedImg),updateEmails())}return e},linkImage=function(n){validateEmail(n)?linkEmail(n)||(linkedImgs[displayedImg.id]=displayedImg,linkedImgs[displayedImg.id].links.push(n),$("#links-count").html('<i class="fas fa-link" id="icon-link"></i> '.concat(linkedImgs[displayedImg.id].links.length)),noLinksInfo.add(noLinksInfoSide).hide(),linksList.add(linksListSide).append('\n                <li>\n                    <span class="email-links-count">'.concat(savedEmails[n].length,'</span> <span class="email-link">').concat(n,"</span>\n                </li>\n            ")),btnHamburger.hasClass("notification")||btnHamburger.toggleClass("notification"),lastUsedEmail=n,linkStatus.removeClass("fail").addClass("success").html('<i class="fas fa-exclamation-circle"></i> Linked!'),setTimeout(function(){modalFade("out")},1e3)):(emailField.focus(),linkStatus.addClass("fail").html('<i class="fas fa-exclamation-circle"></i> Invalid email! Try again.'),modalBtnDisable("enable"))},validateEmail=function(n){return 0<(n.match(mailFormat)&&n.length)},updateEmails=function(){for(var n in allLinkedEmailsList.children().toArray().forEach(function(n){return $(n).remove()}),savedEmails)allLinkedEmailsList.append('\n            <li>\n                <span class="email-links-count">'.concat(savedEmails[n].length,'</span> <span class="email-link">').concat(n,"</span>\n            </li>\n        "))},getSavedImages=function(a){$("#column-1, #column-2").add(loadedImg).fadeOut(500),setTimeout(function(){$("#column-1, #column-2").add(loadedImg).remove();for(var n=1;n<=2;n++)imgContainer.append('<div id="column-'.concat(n,'"></div>'));loadSavedImages(savedEmails[a],displayLoadedImages)},500)},loadSavedImages=function(n,a){for(var i=0,e=n.length,l=function(){return 0==--e&&a(s)},s={};i<n.length;){var t=s[i]=new Image;t.src=n[i].download_url,t.className="loaded-linked-img",t.id=n[i].id,t.onload=l,i++}},displayLoadedImages=function(n){var a,i=1;for(a in n)$("#column-".concat(i)).append('<div class="linked-img" id="img-'.concat(n[a].id,'"></div>')),$("#img-".concat(n[a].id)).append(n[a]),i++&&2<i&&(i=1)},logoColor=function(){var n=0;setInterval(function(){$("#icon-logo").css({color:"hsl(".concat(n,", 90%, 60%)"),"text-shadow":"0 0 5px hsl(".concat(n,", 90%, 60%)")}),n++&&360===n&&(n=0)},10)},modalFade=function(n){"in"===n?(linkBox.fadeIn(500),emailField.focus(),null!==lastUsedEmail&&($("#past-email").show(),btnPastEmail.html("".concat(lastUsedEmail)))):"out"===n&&linkBox.fadeOut(500,function(){emailField.val(""),modalBtnDisable("enable"),linkStatus.removeClass("success","fail").html("")})},modalBtnDisable=function(n){"disable"===n?btnPastEmail.add(btnCancel).add(btnLinkIt).attr("disabled","disabled"):"enable"===n&&btnPastEmail.add(btnCancel).add(btnLinkIt).removeAttr("disabled")};$(document).ready(function(){logoColor(),getImages()}),btnHamburger.on("click",function(){$(this).toggleClass("is-active"),$(this).hasClass("notification")&&$(this).toggleClass("notification"),thisImgLinksHead.add(allImgsLinksHead).removeClass("submenu--closed submenu--open"),$(window).width()<1024?(thisImgLinksHead.addClass("submenu--open").next().slideDown(500),allImgsLinksHead.addClass("submenu--closed").next().hide()):(thisImgLinksHead.addClass("submenu--closed").next().hide(),allImgsLinksHead.addClass("submenu--open").next().slideDown(500))}),$(".site-overlay").on("click",function(){return btnHamburger.toggleClass("is-active")}),thisImgLinksHead.add(allImgsLinksHead).on("click",function(n){$(n.target).hasClass("submenu--closed")?$(n.target).removeClass("submenu--closed").addClass("submenu--open").next().slideDown(200):$(n.target).removeClass("submenu--open").addClass("submenu--closed").next().slideUp(200)}),btnLink.on("click",function(){return modalFade("in")}),btnRefresh.on("click",function(){var n=!!$("#column-1").length;newImage(n,!1)}),linkBox.on("click",function(n){Object.values($("#link-input").find("*")).includes(n.target)||modalFade("out")}),btnPastEmail.on("click",function(){modalBtnDisable("disable"),linkImage(lastUsedEmail)}),btnCancel.on("click",function(){return modalFade("out")}),btnLinkIt.on("click",function(){var n=emailField.val();modalBtnDisable("disable"),linkImage(n)}),emailField.keyup(function(n){13===n.keyCode&&btnLinkIt.click()}),$(document).on("click",".email-link",function(n){btnLink.addClass("loading").attr("disabled","disabled");var a=n.target.textContent;getSavedImages("".concat(a));n=1===savedEmails[a].length?"1 image linked to":"".concat(savedEmails[a].length," images linked to");imgInfo.html('\n        <div id="photo-heading">\n            <div id="photo-id">\n                <h2>'.concat(n,'</h2><br/>\n            </div>\n        </div>\n        <span id="selected-email">').concat(a,"</span>\n    ")),linksInfo.add(linksInfoSide).hide()}),$(document).on("click",".loaded-linked-img",function(n){var a=!!$("#column-1").length,n=$(n.target).attr("id");displayedImg=linkedImgs[n],newImage(a,!0)});